<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>socket &mdash; Документация python документация 2015.05.20</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2015.05.20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Документация python документация 2015.05.20" href="../index.html" />
    <link rel="up" title="Основные модули" href="index.html" />
    <link rel="next" title="sqlite3" href="sqlite3.html" />
    <link rel="prev" title="shutil" href="shutil.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Навигация</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Алфавитный указатель"
             accesskey="I">указатель</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Содержание модулей Python"
             >модули</a> |</li>
        <li class="right" >
          <a href="sqlite3.html" title="sqlite3"
             accesskey="N">вперёд</a> |</li>
        <li class="right" >
          <a href="shutil.html" title="shutil"
             accesskey="P">назад</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Документация python документация 2015.05.20</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Основные модули</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="socket">
<h1>socket<a class="headerlink" href="#socket" title="Ссылка на этот заголовок">¶</a></h1>
<p>работа с синезубом</p>
<div class="highlight-python"><div class="highlight"><pre>import socket

address, services = socket.bt_obex_discover()

print &quot;Chosen device:&quot;, address, services
# Chosen device: 00:12:d2:41:35:e4 {u&quot;OBEX Object Push&quot;:9}

MY_PC = &quot;00:12:d2:41:35:e4&quot;
address, services = socket.bt_obex_discover(MY_PC)


Example 56: Send photos to another phone using Bluetooth

import camera, e32, socket, appuifw

PHOTO = u&quot;e:\\Images\\bt_photo_send.jpg&quot;

def send_photo():
    try:
        address, services = socket.bt_obex_discover()
    except:
        appuifw.note(u&quot;OBEX Push not available&quot;, &quot;error&quot;)
    return

    if u&#39;OBEX Object Push&#39; in services:
        channel = services[u&#39;OBEX Object Push&#39;]
        socket.bt_obex_send_file(address, channel, PHOTO)
        appuifw.note(u&quot;photo sent&quot;, &quot;info&quot;)
    else:
    appuifw.note(u&quot;OBEX Push not available&quot;, &quot;error&quot;)

def take_photo():
    photo = camera.take_photo()
    canvas.blit(photo, scale = 1)
    photo.save(PHOTO)

def quit():
    app_lock.signal()

canvas = appuifw.Canvas()
appuifw.app.body = canvas
appuifw.app.exit_key_handler = quit
appuifw.app.title = u&quot;BT photo send&quot;
appuifw.app.menu = [(u&quot;Take photo&quot;, take_photo),\
(u&quot;Send photo&quot;, send_photo)]
app_lock = e32.Ao_lock()
app_lock.wait()


# BT Chat

import socket, appuifw

def chat_server():
    server = socket.socket(socket.AF_BT, socket.SOCK_STREAM)
    channel = socket.bt_rfcomm_get_available_server_channel(server)
    server.bind((&quot;&quot;, channel))
    server.listen(1)
    socket.bt_advertise_service(u&quot;btchat&quot;, server, True, socket.RFCOMM)
    socket.set_security(server, socket.AUTH | socket.AUTHOR)
    print &quot;Waiting for clients...&quot;
    conn, client_addr = server.accept()
    print &quot;Client connected!&quot;
    talk(conn, None)
def chat_client():
    conn = socket.socket(socket.AF_BT, socket.SOCK_STREAM)PHONE-TO-PHONE COMMUNICATION
    139
    address, services = socket.bt_discover()
    if &#39;btchat&#39; in services:
        channel = services[u&#39;btchat&#39;]
        conn.connect((address, channel))
        print &quot;Connected to server!&quot;
        talk(None, conn)
    else:
        appuifw.note(u&quot;Target is not running a btchat server&quot;, &quot;error&quot;)

def receive_msg(fd):
    print &quot;Waiting for message..&quot;
    reply = fd.readline()
    print &quot;Received: &quot; + reply
    appuifw.note(unicode(reply), &quot;info&quot;)

def send_msg(fd):
    msg = appuifw.query(u&quot;Send a message:&quot;, &quot;text&quot;)
    print &quot;Sending: &quot; + msg
    print &gt;&gt; fd, msg

def talk(client, server):
    try:
        if server:
            fd = server.makefile(&quot;rw&quot;, 0)
            receive_msg(fd)
        if client:
            fd = client.makefile(&quot;rw&quot;, 0)
        while True:
            send_msg(fd)
            receive_msg(fd)
    except:
        appuifw.note(u&quot;Connection lost&quot;, &quot;info&quot;)
        if client:
            client.close()
        if server:
            server.close()
        print &quot;Bye!&quot;

index = appuifw.popup_menu([u&quot;New server&quot;, u&quot;Connect to server&quot;], u&quot;BTChat mode&quot;)
if index != None:
    if index:
        chat_client()
    else:
        chat_server()


Example 59: Bluetooth client

import appuifw, socket, e32

ECHO = True

def choose_service(services):
    names = []
    channels = []
    for name, channel in services.items():
        names.append(name)
        channels.append(channel)
    index = appuifw.popup_menu(names, u&quot;Choose service&quot;)
    return channels[index]

def read_and_echo(fd):
    buf = r = &quot;&quot;
    while r != &quot;\n&quot; and r != &quot;\r&quot;:
        r = fd.read(1)
        if ECHO: fd.write(r)
        buf += r
    if ECHO: fd.write(&quot;\n&quot;)
    return buf

address, services = socket.bt_discover()
channel = choose_service(services)
conn = socket.socket(socket.AF_BT, socket.SOCK_STREAM)
conn.connect((address, channel))
to_peer = conn.makefile(&quot;rw&quot;, 0)

while True:
    msg = appuifw.query(u&quot;Send a message&quot;, &quot;text&quot;)
    if msg:
        print &gt;&gt; to_peer, msg + &quot;\r&quot;
        print &quot;Sending: &quot; + msg
        print &quot;Waiting for reply...&quot;
        reply = read_and_echo(to_peer).strip()
        appuifw.note(unicode(reply), &quot;info&quot;)
    if reply.find(&quot;bye!&quot;) != -1:
        break
    else:
        break
to_peer.close()
conn.close()
print &quot;bye!&quot;
</pre></div>
</div>
<div class="section" id="id1">
<h2>гпс через бт<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>import socket

# Findabluetooth GPS
address , services = socket .btdiscover( )
print ”Discovered : %s , %s ” % (address, services )

target = (address , services.values( )[0] )

# Connect
conn = socket.socket(socket.AF BT , socket.SOCK STREAM)
conn.connect(target)
gps = conn.makefile( ”r” , 0 )
while True :
    # Get sentence , strip of CR/NL or other whitespace
    sentence = gps.readline().strip()
    if sentence[0:3 ] == ’$GP ’ and sentence[ −3] == ’ ∗ ’ :
        print sentence [3:6]

возвращаемый ответ
RMC -&gt; Recommended Minimum sentence C
123519 -&gt; Fix taken at 12:35:19 UTC
A -&gt; Status A=activeo V=Void
4807.038,N -&gt; Latitude 48 deg 07.038’N
01131.000,E -&gt; Longitude 11 deg 31.000’E
022.4 -&gt; Speed over the ground in knots
084.4 -&gt; Track angle in degrees True
230394 -&gt; Date − 23 rd of March 1994
003.1,W -&gt; Magnetic Variation
∗6A -&gt; The checksum data, always begins with ∗



А ТУТ МЫ СЧИТАЕМ РАССТОЯНИЕ

import math

# radians and degrees are omitted from the pys60 math distribution
def radians(degrees) :
    return(math.pi ∗ degrees)/180.0

def distance(lat1, lon1, lat2, lon2) :
    ”””Computes the geodesic distance, in meters ,
    between two locations expressed in geographic coordinates
    Ref : http://en.wikipedia.org/wiki/Haversineformula”””

    R = 6371000 # Earth radius in meters (approximately)

    dLat = radians(float(lat2) − float(lat1))
    dLon = radians(float(lon2) − float(lon1))
    a = math.sin(dLat/2.0) ∗ math.sin(dLat/2.0)\
    + math.cos(radians(float(lat1))) ∗ math.cos(radians(float(lat2)))\
    ∗ math.sin(dLon/2.0) ∗ math.sin(dLon/2.0) ;
    c = 2.0 ∗ math.atan2(math.sqrt(a), math.sqrt(1.0 − a))
    return R ∗ c
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Оглавление</a></h3>
  <ul>
<li><a class="reference internal" href="#">socket</a><ul>
<li><a class="reference internal" href="#id1">гпс через бт</a></li>
</ul>
</li>
</ul>

  <h4>Предыдущий раздел</h4>
  <p class="topless"><a href="shutil.html"
                        title="предыдущая глава">shutil</a></p>
  <h4>Следующий раздел</h4>
  <p class="topless"><a href="sqlite3.html"
                        title="следующая глава">sqlite3</a></p>
  <div role="note" aria-label="source link">
    <h3>Эта страница</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/modules/socket.txt"
            rel="nofollow">Исходный текст</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Быстрый поиск</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Искать" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Введите слова для поиска или имя модуля, класса или функции.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Навигация</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Алфавитный указатель"
             >указатель</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Содержание модулей Python"
             >модули</a> |</li>
        <li class="right" >
          <a href="sqlite3.html" title="sqlite3"
             >вперёд</a> |</li>
        <li class="right" >
          <a href="shutil.html" title="shutil"
             >назад</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Документация python документация 2015.05.20</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Основные модули</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright ilnurgi.
      Создано с помощью <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>